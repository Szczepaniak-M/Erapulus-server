<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">
    <changeSet author="Szczepaniak-M" id="202108141232">
        <comment>Initialize tables</comment>
        <createTable tableName="university">
            <column autoIncrement="true" name="id" type="INT">
                <constraints primaryKey="true"/>
            </column>
            <column name="name" type="NVARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="address" type="NVARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="address2" type="NVARCHAR(255)">
                <constraints nullable="true"/>
            </column>
            <column name="zipcode" type="VARCHAR(31)">
                <constraints nullable="false"/>
            </column>
            <column name="city" type="NVARCHAR(63)">
                <constraints nullable="false"/>
            </column>
            <column name="country" type="NVARCHAR(63)">
                <constraints nullable="false"/>
            </column>
            <column name="website_url" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="NVARCHAR(MAX)">
                <constraints nullable="true"/>
            </column>
            <column name="logo_url" type="VARCHAR(255)">
                <constraints nullable="true"/>
            </column>
            <column name="last_modified_by" type="INT">
                <constraints nullable="true"/>
            </column>
        </createTable>
        <createTable tableName="faculty">
            <column autoIncrement="true" name="id" type="INT">
                <constraints primaryKey="true"/>
            </column>
            <column name="name" type="NVARCHAR(31)">
                <constraints nullable="false"/>
            </column>
            <column name="address" type="NVARCHAR(63)">
                <constraints nullable="false"/>
            </column>
            <column name="email" type="VARCHAR(63)">
                <constraints nullable="false"/>
            </column>
            <column name="university" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="last_modified_by" type="INT">
                <constraints nullable="true"/>
            </column>
        </createTable>
        <createTable tableName="program">
            <column autoIncrement="true" name="id" type="INT">
                <constraints primaryKey="true"/>
            </column>
            <column name="name" type="NVARCHAR(31)">
                <constraints nullable="false"/>
            </column>
            <column name="abbrev" type="NVARCHAR(7)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="NVARCHAR(MAX)">
                <constraints nullable="true"/>
            </column>
            <column name="faculty" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="last_modified_by" type="INT">
                <constraints nullable="true"/>
            </column>
        </createTable>
        <createTable tableName="module">
            <column autoIncrement="true" name="id" type="INT">
                <constraints primaryKey="true"/>
            </column>
            <column name="name" type="NVARCHAR(31)">
                <constraints nullable="false"/>
            </column>
            <column name="abbrev" type="NVARCHAR(7)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="NVARCHAR(MAX)">
                <constraints nullable="true"/>
            </column>
            <column name="program" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="last_modified_by" type="INT">
                <constraints nullable="true"/>
            </column>
        </createTable>
        <createTable tableName="building">
            <column autoIncrement="true" name="id" type="INT">
                <constraints primaryKey="true"/>
            </column>
            <column name="name" type="NVARCHAR(31)">
                <constraints nullable="false"/>
            </column>
            <column name="abbrev" type="NVARCHAR(7)">
                <constraints nullable="false"/>
            </column>
            <column name="latitude" type="DOUBLE">
                <constraints nullable="false"/>
            </column>
            <column name="longitude" type="DOUBLE">
                <constraints nullable="false"/>
            </column>
            <column name="university" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="last_modified_by" type="INT">
                <constraints nullable="true"/>
            </column>
        </createTable>
        <createTable tableName="post">
            <column autoIncrement="true" name="id" type="INT">
                <constraints primaryKey="true"/>
            </column>
            <column name="title" type="NVARCHAR(63)">
                <constraints nullable="false"/>
            </column>
            <column name="date" type="DATE" defaultValueComputed="CURRENT_TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="content" type="NVARCHAR(MAX)">
                <constraints nullable="false"/>
            </column>
            <column name="university" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="last_modified_by" type="INT">
                <constraints nullable="true"/>
            </column>
        </createTable>
        <createTable tableName="document">
            <column name="id" autoIncrement="true" type="INT">
                <constraints primaryKey="true"/>
            </column>
            <column name="name" type="NVARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="NVARCHAR(MAX)">
                <constraints nullable="true"/>
            </column>
            <column name="path" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="university" type="INT">
                <constraints nullable="true"/>
            </column>
            <column name="program" type="INT">
                <constraints nullable="true"/>
            </column>
            <column name="module" type="INT">
                <constraints nullable="true"/>
            </column>
            <column name="last_modified_by" type="INT">
                <constraints nullable="true"/>
            </column>
        </createTable>
        <createTable tableName="application_user">
            <column name="id" autoIncrement="true" type="INT">
                <constraints primaryKey="true"/>
            </column>
            <column name="type" type="VARCHAR(31)">
                <constraints nullable="false"/>
            </column>
            <column name="first_name" type="NVARCHAR(31)">
                <constraints nullable="false"/>
            </column>
            <column name="last_name" type="NVARCHAR(31)">
                <constraints nullable="false"/>
            </column>
            <column name="email" type="VARCHAR(63)">
                <constraints nullable="false"/>
            </column>
            <column name="phone_number" type="VARCHAR(15)">
                <constraints nullable="true"/>
            </column>
            <column name="password" type="VARCHAR(255)">
                <constraints nullable="true"/>
            </column>
            <column name="facebook_url" type="VARCHAR(255)">
                <constraints nullable="true"/>
            </column>
            <column name="whats_up_url" type="VARCHAR(255)">
                <constraints nullable="true"/>
            </column>
            <column name="instagram_username" type="VARCHAR(63)">
                <constraints nullable="true"/>
            </column>
            <column name="picture_url" type="VARCHAR(255)">
                <constraints nullable="true"/>
            </column>
            <column name="university" type="int">
                <constraints nullable="true"/>
            </column>
            <column name="last_modified_by" type="INT">
                <constraints nullable="true"/>
            </column>
        </createTable>
        <createTable tableName="friendship">
            <column name="id" type="INT" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="application_user" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="friend" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="status" type="VARCHAR(15)">
                <constraints nullable="false"/>
            </column>
            <column name="last_modified_by" type="INT">
                <constraints nullable="true"/>
            </column>
        </createTable>
        <createTable tableName="device">
            <column name="id" autoIncrement="true" type="INT">
                <constraints primaryKey="true"/>
            </column>
            <column name="application_user" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="device_id" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="name" type="NVARCHAR(63)">
                <constraints nullable="false"/>
            </column>
            <column name="last_modified_by" type="INT">
                <constraints nullable="true"/>
            </column>
        </createTable>
        <!-- FK Constraints-->
        <addForeignKeyConstraint baseTableName="document" baseColumnNames="university"
                                 constraintName="fk_document_university_university"
                                 referencedTableName="university" referencedColumnNames="id"
                                 onDelete="RESTRICT" onUpdate="RESTRICT"/>
        <addForeignKeyConstraint baseTableName="document" baseColumnNames="program"
                                 constraintName="fk_document_program_program"
                                 referencedTableName="program" referencedColumnNames="id"
                                 onDelete="RESTRICT" onUpdate="RESTRICT"/>
        <addForeignKeyConstraint baseTableName="document" baseColumnNames="module"
                                 constraintName="fk_document_module_module"
                                 referencedTableName="module" referencedColumnNames="id"
                                 onDelete="RESTRICT" onUpdate="RESTRICT"/>
        <addForeignKeyConstraint baseTableName="building" baseColumnNames="university"
                                 constraintName="fk_building_university_university"
                                 referencedTableName="university" referencedColumnNames="id"
                                 onDelete="RESTRICT" onUpdate="RESTRICT"/>
        <addForeignKeyConstraint baseTableName="post" baseColumnNames="university"
                                 constraintName="fk_post_university_university"
                                 referencedTableName="university" referencedColumnNames="id"
                                 onDelete="RESTRICT" onUpdate="RESTRICT"/>
        <addForeignKeyConstraint baseTableName="faculty" baseColumnNames="university"
                                 constraintName="fk_faculty_university_university"
                                 referencedTableName="university" referencedColumnNames="id"
                                 onDelete="RESTRICT" onUpdate="RESTRICT"/>
        <addForeignKeyConstraint baseTableName="program" baseColumnNames="faculty"
                                 constraintName="fk_program_faculty_faculty"
                                 referencedTableName="faculty" referencedColumnNames="id"
                                 onDelete="RESTRICT" onUpdate="RESTRICT"/>
        <addForeignKeyConstraint baseTableName="module" baseColumnNames="program"
                                 constraintName="fk_module_program_program"
                                 referencedTableName="program" referencedColumnNames="id"
                                 onDelete="RESTRICT" onUpdate="RESTRICT"/>
        <addForeignKeyConstraint baseTableName="application_user" baseColumnNames="university"
                                 constraintName="fk_application_user_university_university"
                                 referencedTableName="university" referencedColumnNames="id"
                                 onDelete="SET NULL" onUpdate="RESTRICT"/>
        <addForeignKeyConstraint baseTableName="device" baseColumnNames="application_user"
                                 constraintName="fk_device_application_user_application_user"
                                 referencedTableName="application_user" referencedColumnNames="id"
                                 onDelete="RESTRICT" onUpdate="RESTRICT"/>
        <addForeignKeyConstraint baseTableName="friendship" baseColumnNames="application_user"
                                 constraintName="fk_friendship_user_application_user"
                                 referencedTableName="application_user" referencedColumnNames="id"
                                 onDelete="RESTRICT" onUpdate="RESTRICT"/>
        <addForeignKeyConstraint baseTableName="friendship" baseColumnNames="friend"
                                 constraintName="fk_friendship_friend_application_user"
                                 referencedTableName="application_user" referencedColumnNames="id"
                                 onDelete="RESTRICT" onUpdate="RESTRICT"/>

        <!-- Unique Constraints -->
        <addUniqueConstraint tableName="friendship" columnNames="application_user, friend"
                             constraintName="uq_friendship_application_user_friend"/>
        <addUniqueConstraint tableName="application_user" columnNames="email"
                             constraintName="uq_application_user_email"/>
        <addUniqueConstraint tableName="building" columnNames="university, name"
                             constraintName="uq_building_university_name"/>
        <addUniqueConstraint tableName="post" columnNames="university, title, date"
                             constraintName="uq_post_university_title_date"/>
        <addUniqueConstraint tableName="university" columnNames="name"
                             constraintName="uq_university_name"/>
        <addUniqueConstraint tableName="faculty" columnNames="university, name"
                             constraintName="uq_faculty_university_name"/>
        <addUniqueConstraint tableName="program" columnNames="faculty, name"
                             constraintName="uq_program_faculty_name"/>
        <addUniqueConstraint tableName="module" columnNames="program, name"
                             constraintName="uq_module_program_name"/>
        <addUniqueConstraint tableName="device" columnNames="device_id"
                             constraintName="uq_device_device"/>

        <!-- lastModifiedBy Constraints -->
        <addForeignKeyConstraint baseTableName="university" baseColumnNames="last_modified_by"
                                 constraintName="fk_university_last_modified_by_application_user"
                                 referencedTableName="application_user" referencedColumnNames="id"
                                 onDelete="RESTRICT" onUpdate="RESTRICT"/>
        <addForeignKeyConstraint baseTableName="document" baseColumnNames="last_modified_by"
                                 constraintName="fk_document_last_modified_by_application_user"
                                 referencedTableName="application_user" referencedColumnNames="id"
                                 onDelete="RESTRICT" onUpdate="RESTRICT"/>
        <addForeignKeyConstraint baseTableName="application_user" baseColumnNames="last_modified_by"
                                 constraintName="fk_application_user_last_modified_by_application_user"
                                 referencedTableName="application_user" referencedColumnNames="id"
                                 onDelete="RESTRICT" onUpdate="RESTRICT"/>
        <addForeignKeyConstraint baseTableName="device" baseColumnNames="last_modified_by"
                                 constraintName="fk_device_last_modified_by_application_user"
                                 referencedTableName="application_user" referencedColumnNames="id"
                                 onDelete="RESTRICT" onUpdate="RESTRICT"/>
        <addForeignKeyConstraint baseTableName="friendship" baseColumnNames="last_modified_by"
                                 constraintName="fk_friendship_last_modified_by_application_user"
                                 referencedTableName="application_user" referencedColumnNames="id"
                                 onDelete="RESTRICT" onUpdate="RESTRICT"/>
        <addForeignKeyConstraint baseTableName="building" baseColumnNames="last_modified_by"
                                 constraintName="fk_building_last_modified_by_application_user"
                                 referencedTableName="application_user" referencedColumnNames="id"
                                 onDelete="RESTRICT" onUpdate="RESTRICT"/>
        <addForeignKeyConstraint baseTableName="faculty" baseColumnNames="last_modified_by"
                                 constraintName="fk_faculty_last_modified_by_application_user"
                                 referencedTableName="application_user" referencedColumnNames="id"
                                 onDelete="RESTRICT" onUpdate="RESTRICT"/>
        <addForeignKeyConstraint baseTableName="post" baseColumnNames="last_modified_by"
                                 constraintName="fk_post_last_modified_by_application_user"
                                 referencedTableName="application_user" referencedColumnNames="id"
                                 onDelete="RESTRICT" onUpdate="RESTRICT"/>
        <addForeignKeyConstraint baseTableName="module" baseColumnNames="last_modified_by"
                                 constraintName="fk_Mmodule_last_modified_by_application_user"
                                 referencedTableName="application_user" referencedColumnNames="id"
                                 onDelete="RESTRICT" onUpdate="RESTRICT"/>
        <addForeignKeyConstraint baseTableName="program" baseColumnNames="last_modified_by"
                                 constraintName="fk_program_last_modified_by_application_user"
                                 referencedTableName="application_user" referencedColumnNames="id"
                                 onDelete="RESTRICT" onUpdate="RESTRICT"/>
        <rollback>
            <dropTable tableName="device"/>
            <dropTable tableName="friendship"/>
            <dropTable tableName="document"/>
            <dropTable tableName="module"/>
            <dropTable tableName="program"/>
            <dropTable tableName="faculty"/>
            <dropTable tableName="post"/>
            <dropTable tableName="building"/>
            <dropTable tableName="application_user"/>
            <dropTable tableName="university"/>
        </rollback>
    </changeSet>
    <changeSet id="202108141328" author="Szczepaniak-M" dbms="mssql">
        <comment>Adding history tables</comment>
        <createTable tableName="university_history">
            <column name="history_id" type="INT" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="operation" type="VARCHAR(7)">
                <constraints nullable="false"/>
            </column>
            <column name="operation_time" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="id" type="INT"/>
            <column name="name" type="NVARCHAR(255)"/>
            <column name="address" type="NVARCHAR(255)"/>
            <column name="address2" type="NVARCHAR(255)"/>
            <column name="zipcode" type="VARCHAR(31)"/>
            <column name="city" type="NVARCHAR(63)"/>
            <column name="country" type="NVARCHAR(63)"/>
            <column name="website_url" type="VARCHAR(255)"/>
            <column name="description" type="NVARCHAR(MAX)"/>
            <column name="logo_url" type="VARCHAR(255)"/>
            <column name="last_modified_by" type="INT"/>
        </createTable>
        <createTable tableName="document_history">
            <column name="history_id" type="INT" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="operation" type="VARCHAR(7)">
                <constraints nullable="false"/>
            </column>
            <column name="operation_time" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="id" type="INT"/>
            <column name="name" type="NVARCHAR(255)"/>
            <column name="description" type="NVARCHAR(MAX)"/>
            <column name="path" type="VARCHAR(255)"/>
            <column name="university" type="INT"/>
            <column name="program" type="INT"/>
            <column name="module" type="INT"/>
            <column name="last_modified_by" type="INT"/>
        </createTable>
        <createTable tableName="application_user_history">
            <column name="history_id" type="INT" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="operation" type="VARCHAR(7)">
                <constraints nullable="false"/>
            </column>
            <column name="operation_time" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="id" type="INT"/>
            <column name="type" type="VARCHAR(31)"/>
            <column name="first_name" type="NVARCHAR(31)"/>
            <column name="last_name" type="NVARCHAR(31)"/>
            <column name="email" type="VARCHAR(63)"/>
            <column name="phone_number" type="VARCHAR(15)"/>
            <column name="password" type="VARCHAR(255)"/>
            <column name="facebook_url" type="VARCHAR(255)"/>
            <column name="whats_up_url" type="VARCHAR(255)"/>
            <column name="instagram_username" type="VARCHAR(63)"/>
            <column name="picture_url" type="VARCHAR(255)"/>
            <column name="university" type="int"/>
            <column name="last_modified_by" type="INT"/>
        </createTable>
        <createTable tableName="friendship_history">
            <column name="history_id" type="INT" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="operation" type="VARCHAR(7)">
                <constraints nullable="false"/>
            </column>
            <column name="operation_time" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="id" type="INT"/>
            <column name="application_user" type="INT"/>
            <column name="friend" type="INT"/>
            <column name="status" type="VARCHAR(15)"/>
            <column name="last_modified_by" type="INT"/>
        </createTable>
        <createTable tableName="device_history">
            <column name="history_id" type="INT" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="operation" type="VARCHAR(7)">
                <constraints nullable="false"/>
            </column>
            <column name="operation_time" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="id" type="INT"/>
            <column name="application_user" type="INT"/>
            <column name="device_id" type="VARCHAR(255)"/>
            <column name="name" type="NVARCHAR(63)"/>
            <column name="last_modified_by" type="INT"/>
        </createTable>
        <createTable tableName="faculty_history">
            <column autoIncrement="true" name="history_id" type="INT">
                <constraints primaryKey="true"/>
            </column>
            <column name="operation" type="VARCHAR(7)">
                <constraints nullable="false"/>
            </column>
            <column name="operation_time" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="id" type="INT"/>
            <column name="name" type="NVARCHAR(31)"/>
            <column name="address" type="VARCHAR(63)"/>
            <column name="email" type="VARCHAR(63)"/>
            <column name="university" type="INT"/>
            <column name="last_modified_by" type="INT"/>
        </createTable>
        <createTable tableName="program_history">
            <column autoIncrement="true" name="historyId" type="INT">
                <constraints primaryKey="true"/>
            </column>
            <column name="operation" type="VARCHAR(7)">
                <constraints nullable="false"/>
            </column>
            <column name="operation_time" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="id" type="INT"/>
            <column name="name" type="NVARCHAR(31)"/>
            <column name="abbrev" type="NVARCHAR(7)"/>
            <column name="description" type="NVARCHAR(MAX)"/>
            <column name="faculty" type="INT"/>
            <column name="last_modified_by" type="INT"/>
        </createTable>
        <createTable tableName="module_history">
            <column autoIncrement="true" name="history_id" type="INT">
                <constraints primaryKey="true"/>
            </column>
            <column name="operation" type="VARCHAR(7)">
                <constraints nullable="false"/>
            </column>
            <column name="operationTime" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="id" type="INT"/>
            <column name="name" type="NVARCHAR(31)"/>
            <column name="abbrev" type="NVARCHAR(7)"/>
            <column name="description" type="NVARCHAR(MAX)"/>
            <column name="program" type="INT"/>
            <column name="last_modified_by" type="INT"/>
        </createTable>
        <createTable tableName="building_history">
            <column autoIncrement="true" name="historyId" type="INT">
                <constraints primaryKey="true"/>
            </column>
            <column name="operation" type="VARCHAR(7)">
                <constraints nullable="false"/>
            </column>
            <column name="operation_time" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="id" type="INT"/>
            <column name="name" type="NVARCHAR(31)"/>
            <column name="abbrev" type="NVARCHAR(7)"/>
            <column name="latitude" type="DOUBLE"/>
            <column name="longitude" type="DOUBLE"/>
            <column name="university" type="INT"/>
            <column name="last_modified_by" type="INT"/>
        </createTable>
        <createTable tableName="post_history">
            <column autoIncrement="true" name="historyId" type="INT">
                <constraints primaryKey="true"/>
            </column>
            <column name="operation" type="VARCHAR(7)">
                <constraints nullable="false"/>
            </column>
            <column name="operation_time" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="id" type="INT"/>
            <column name="title" type="NVARCHAR(63)"/>
            <column name="date" type="DATE"/>
            <column name="content" type="NVARCHAR(MAX)"/>
            <column name="university" type="INT"/>
            <column name="last_modified_by" type="INT"/>
        </createTable>
        <rollback>
            <dropTable tableName="module_history"/>
            <dropTable tableName="program_history"/>
            <dropTable tableName="program_history"/>
            <dropTable tableName="post_history"/>
            <dropTable tableName="building_history"/>
            <dropTable tableName="device_history"/>
            <dropTable tableName="friend_history"/>
            <dropTable tableName="document_history"/>
            <dropTable tableName="application_user_history"/>
            <dropTable tableName="university_history"/>
        </rollback>
    </changeSet>
    <changeSet id="202108141343" author="Szczepaniak-M" dbms="mssql">
        <comment>Adding triggers to fill history tables</comment>
        <sql endDelimiter="GO">
            -- university_history
            CREATE TRIGGER university_history_after_insert_trigger
                ON university
                AFTER INSERT AS
            BEGIN
                SET NOCOUNT ON;
                INSERT INTO university_history(operation, id, name, address, address2, zipcode, city, country,
                                               website_url, description, logo_url, last_modified_by)
                SELECT 'insert', i.*
                FROM inserted i;
            END
            GO

            CREATE TRIGGER university_history_after_update_trigger
                ON university
                AFTER UPDATE AS
            BEGIN
                SET NOCOUNT ON;
                INSERT INTO university_history(operation, id, name, address, address2, zipcode, city, country,
                                               website_url, description, logo_url, last_modified_by)
                SELECT 'update', i.*
                FROM inserted i;
            END
            GO

            CREATE TRIGGER university_history_after_delete_trigger
                ON university
                AFTER DELETE AS
            BEGIN
                SET NOCOUNT ON;
                INSERT INTO university_history(operation, id, name, address, address2, zipcode, city, country,
                                               website_url, description, logo_url, last_modified_by)
                SELECT 'delete', d.*
                FROM deleted d;
            END
            GO

            -- faculty_history
            CREATE TRIGGER faculty_history_after_insert_trigger
                ON faculty
                AFTER INSERT AS
            BEGIN
                SET NOCOUNT ON;
                INSERT INTO faculty_history(operation, id, name, address, email, university, last_modified_by)
                SELECT 'insert', i.*
                FROM inserted i;
            END
            GO

            CREATE TRIGGER faculty_history_after_update_trigger
                ON faculty
                AFTER UPDATE AS
            BEGIN
                SET NOCOUNT ON;
                INSERT INTO faculty_history(operation, id, name, address, email, university, last_modified_by)
                SELECT 'update', i.*
                FROM inserted i;
            END
            GO

            CREATE TRIGGER faculty_history_after_delete_trigger
                ON faculty
                AFTER DELETE AS
            BEGIN
                SET NOCOUNT ON;
                INSERT INTO faculty_history(operation, id, name, address, email, university, last_modified_by)
                SELECT 'delete', d.*
                FROM deleted d;
            END
            GO

            -- program_history
            CREATE TRIGGER program_history_after_insert_trigger
                ON program
                AFTER INSERT AS
            BEGIN
                SET NOCOUNT ON;
                INSERT INTO program_history(operation, id, name, abbrev, description, faculty, last_modified_by)
                SELECT 'insert', i.*
                FROM inserted i;
            END
            GO

            CREATE TRIGGER program_history_after_update_trigger
                ON program
                AFTER UPDATE AS
            BEGIN
                SET NOCOUNT ON;
                INSERT INTO program_history(operation, id, name, abbrev, description, faculty, last_modified_by)
                SELECT 'update', i.*
                FROM inserted i;
            END
            GO

            CREATE TRIGGER program_history_after_delete_trigger
                ON program
                AFTER DELETE AS
            BEGIN
                SET NOCOUNT ON;
                INSERT INTO program_history(operation, id, name, abbrev, description, faculty, last_modified_by)
                SELECT 'delete', d.*
                FROM deleted d;
            END
            GO

            -- module_history
            CREATE TRIGGER module_history_after_insert_trigger
                ON module
                AFTER INSERT AS
            BEGIN
                SET NOCOUNT ON;
                INSERT INTO module_history(operation, id, name, abbrev, description, program, last_modified_by)
                SELECT 'insert', i.*
                FROM inserted i;
            END
            GO

            CREATE TRIGGER module_history_after_update_trigger
                ON module
                AFTER UPDATE AS
            BEGIN
                SET NOCOUNT ON;
                INSERT INTO module_history(operation, id, name, abbrev, description, program, last_modified_by)
                SELECT 'update', i.*
                FROM inserted i;
            END
            GO

            CREATE TRIGGER module_history_after_delete_trigger
                ON module
                AFTER DELETE AS
            BEGIN
                SET NOCOUNT ON;
                INSERT INTO module_history(operation, id, name, abbrev, description, program, last_modified_by)
                SELECT 'delete', d.*
                FROM deleted d;
            END
            GO

            -- document_history
            CREATE TRIGGER document_history_after_insert_trigger
                ON document
                AFTER INSERT AS
            BEGIN
                SET NOCOUNT ON;
                INSERT INTO document_history(operation, id, name, description, path, university,
                                             program, module, last_modified_by)
                SELECT 'insert', i.*
                FROM inserted i;
            END
            GO

            CREATE TRIGGER document_history_after_update_trigger
                ON document
                AFTER UPDATE AS
            BEGIN
                SET NOCOUNT ON;
                INSERT INTO document_history(operation, id, name, description, path, university,
                                             program, module, last_modified_by)
                SELECT 'update', i.*
                FROM inserted i;
            END
            GO

            CREATE TRIGGER document_history_after_delete_trigger
                ON document
                AFTER DELETE AS
            BEGIN
                SET NOCOUNT ON;
                INSERT INTO document_history(operation, id, name, description, path, university,
                                             program, module, last_modified_by)
                SELECT 'delete', d.*
                FROM deleted d;
            END
            GO

            -- application_user_history
            CREATE TRIGGER application_user_history_after_insert_trigger
                ON application_user
                AFTER INSERT AS
            BEGIN
                SET NOCOUNT ON;
                INSERT INTO application_user_history(operation, id, type, first_name, last_name, email, phone_number,
                                                     password, facebook_url, whats_up_url, instagram_username,
                                                     picture_url, university, last_modified_by)
                SELECT 'insert', i.*
                FROM inserted i;
            END
            GO

            CREATE TRIGGER application_user_history_after_update_trigger
                ON application_user
                AFTER UPDATE AS
            BEGIN
                SET NOCOUNT ON;
                INSERT INTO application_user_history(operation, id, type, first_name, last_name, email, phone_number,
                                                     password, facebook_url, whats_up_url, instagram_username,
                                                     picture_url, university, last_modified_by)
                SELECT 'update', i.*
                FROM inserted i;
            END
            GO

            CREATE TRIGGER application_user_history_after_delete_trigger
                ON application_user
                AFTER DELETE AS
            BEGIN
                SET NOCOUNT ON;
                INSERT INTO application_user_history(operation, id, type, first_name, last_name, email, phone_number,
                                                     password, facebook_url, whats_up_url, instagram_username,
                                                     picture_url, university, last_modified_by)
                SELECT 'delete', d.*
                FROM deleted d;
            END
            GO

            -- device_history
            CREATE TRIGGER device_history_after_insert_trigger
                ON device
                AFTER INSERT AS
            BEGIN
                SET NOCOUNT ON;
                INSERT INTO device_history(operation, id, application_user, device_id, name, last_modified_by)
                SELECT 'insert', i.*
                FROM inserted i;
            END
            GO

            CREATE TRIGGER device_history_after_update_trigger
                ON device
                AFTER UPDATE AS
            BEGIN
                SET NOCOUNT ON;
                INSERT INTO device_history(operation, id, application_user, device_id, name, last_modified_by)
                SELECT 'update', i.*
                FROM inserted i;
            END
            GO

            CREATE TRIGGER device_history_after_delete_trigger
                ON device
                AFTER DELETE AS
            BEGIN
                SET NOCOUNT ON;
                INSERT INTO device_history(operation, id, application_user, device_id, name, last_modified_by)
                SELECT 'delete', d.*
                FROM deleted d;
            END
            GO

            --  friendship_history
            CREATE TRIGGER friendship_history_after_insert_trigger
                ON friendship
                AFTER INSERT AS
            BEGIN
                SET NOCOUNT ON;
                INSERT INTO friendship_history(operation, id, application_user, friend, status, last_modified_by)
                SELECT 'insert', i.*
                FROM inserted i;
            END
            GO

            CREATE TRIGGER friendship_history_after_update_trigger
                ON friendship
                AFTER UPDATE AS
            BEGIN
                SET NOCOUNT ON;
                INSERT INTO friendship_history(operation, id, application_user, friend, status, last_modified_by)
                SELECT 'update', i.*
                FROM inserted i;
            END
            GO

            CREATE TRIGGER friendship_history_after_delete_trigger
                ON friendship
                AFTER DELETE AS
            BEGIN
                SET NOCOUNT ON;
                INSERT INTO friendship_history(operation, id, application_user, friend, status, last_modified_by)
                SELECT 'delete', d.*
                FROM deleted d;
            END
            GO

            -- building_history
            CREATE TRIGGER building_history_after_insert_trigger
                ON building
                AFTER INSERT AS
            BEGIN
                SET NOCOUNT ON;
                INSERT INTO building_history(operation, id, name, abbrev, latitude,
                                             longitude, university, last_modified_by)
                SELECT 'insert', i.*
                FROM inserted i;
            END
            GO

            CREATE TRIGGER building_history_after_update_trigger
                ON building
                AFTER UPDATE AS
            BEGIN
                SET NOCOUNT ON;
                INSERT INTO building_history(operation, id, name, abbrev, latitude,
                                             longitude, university, last_modified_by)
                SELECT 'update', i.*
                FROM inserted i;
            END
            GO

            CREATE TRIGGER building_history_after_delete_trigger
                ON building
                AFTER DELETE AS
            BEGIN
                SET NOCOUNT ON;
                INSERT INTO building_history(operation, id, name, abbrev, latitude,
                                             longitude, university, last_modified_by)
                SELECT 'delete', d.*
                FROM deleted d;
            END
            GO

            -- post_history
            CREATE TRIGGER post_history_after_insert_trigger
                ON post
                AFTER INSERT AS
            BEGIN
                SET NOCOUNT ON;
                INSERT INTO post_history(operation, id, title, date, content, university, last_modified_by)
                SELECT 'insert', i.*
                FROM inserted i;
            END
            GO

            CREATE TRIGGER post_history_after_update_trigger
                ON post
                AFTER UPDATE AS
            BEGIN
                SET NOCOUNT ON;
                INSERT INTO post_history(operation, id, title, date, content, university, last_modified_by)
                SELECT 'update', i.*
                FROM inserted i;
            END
            GO

            CREATE TRIGGER post_history_after_delete_trigger
                ON post
                AFTER DELETE AS
            BEGIN
                SET NOCOUNT ON;
                INSERT INTO post_history(operation, id, title, date, content, university, last_modified_by)
                SELECT 'delete', d.*
                FROM deleted d;
            END
            GO
        </sql>
        <rollback>
            <sql>
                DROP TRIGGER IF EXISTS module_history_after_insert_trigger;
                DROP TRIGGER IF EXISTS module_history_after_update_trigger;
                DROP TRIGGER IF EXISTS module_history_after_delete_trigger;

                DROP TRIGGER IF EXISTS program_history_after_insert_trigger;
                DROP TRIGGER IF EXISTS program_history_after_update_trigger;
                DROP TRIGGER IF EXISTS program_history_after-delete_trigger;

                DROP TRIGGER IF EXISTS faculty_history_after_insert_trigger;
                DROP TRIGGER IF EXISTS faculty_history_after_update_trigger;
                DROP TRIGGER IF EXISTS faculty_history_after-delete_trigger;

                DROP TRIGGER IF EXISTS post_history_after_insert_trigger;
                DROP TRIGGER IF EXISTS post_history_after_update_trigger;
                DROP TRIGGER IF EXISTS post_history_after-delete_trigger;

                DROP TRIGGER IF EXISTS building_history_after_insert_trigger;
                DROP TRIGGER IF EXISTS building_history_after_update_trigger;
                DROP TRIGGER IF EXISTS building_history_after_delete_trigger;

                DROP TRIGGER IF EXISTS device_history_after_insert_trigger;
                DROP TRIGGER IF EXISTS device_history_after_update_trigger;
                DROP TRIGGER IF EXISTS device_history_after_delete_trigger;

                DROP TRIGGER IF EXISTS friend_history_after_insert_trigger;
                DROP TRIGGER IF EXISTS friend_history_after_update_trigger;
                DROP TRIGGER IF EXISTS friend_history_after_delete_trigger;

                DROP TRIGGER IF EXISTS university_history_after_insert_trigger;
                DROP TRIGGER IF EXISTS university_history_after_update_trigger;
                DROP TRIGGER IF EXISTS university_history_after_delete_trigger;

                DROP TRIGGER IF EXISTS application_user_history_after_insert_trigger;
                DROP TRIGGER IF EXISTS application_user_history_after_update_trigger;
                DROP TRIGGER IF EXISTS application_user_history_after_delete_trigger;
                GO
            </sql>
        </rollback>
    </changeSet>
</databaseChangeLog>
